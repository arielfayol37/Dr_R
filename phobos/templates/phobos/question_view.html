<!--phobos: question_view.html-->
{% extends 'phobos/layout.html' %}
{% load static %}
{% block title %} Question {% endblock %}

<!--The following script is included in phobos/question_view.js. It couldn't load properly from here 
    for a reason I ignore.
-->
<!--<script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
-->

{% block body %}
  
<div class="sidebar" style="display:none">
    <header class="sidebar-header">X</header>
    <ul>
        <li><a href="{% url 'phobos:index' %}">Home</a></li>
        <li><a href="{% url 'phobos:assignment_management' assignment_id=question.assignment.id course_id=question.assignment.course.id %}">Questions</a></li>
        <li><a href="{% url 'phobos:course_management' course_id=question.assignment.course.id %}">Assignments</a></li>
        <li><a href="{% url 'phobos:search_question' %}">Search Question</a></li>

    </ul>
  </div>

<div class="export_question">
    <button class=" btn-primary"> Export this question</button>
    <div style="display: none;"> 
        <form action="" >
            {% csrf_token %}
        <select >
            {% for assignment in assignments %}
        <option value="{{assignment.id}}" > {{assignment.name}} </option>
            {% endfor %}
        </select>
        <input type="button" value="Confirm"> 
    </form>
    </div>
    <p class="export_result"></p>
</div>

<div class="embed">
<p class="question-number"><strong>Question {{question.number}}</strong></p>
<hr/>
<p class="question-content">{{question.text|safe}}</p>
<div class="question-images">
    {% for question_image in question.images.all %}
        <div class="formatted-answer" id="{{question_image.image.url}}">
            <p>{{question_image.label}}</p>
            <img src="{{question_image.image.url}}" class="question-image image-in-formatted" alt="{{question_image.label}}"/>
        </div>
    {% endfor %}
</div><br/>

{% if show_answer %}

    {% if is_mcq %}
        {% for answer, is_latex in answers_is_latex %}
            <div class="formatted-answer">
                {% if is_latex %}
                    <input type="hidden" class="latex-answer-question-view" value="{{answer.content}}">
                {% else %}   
                    {% if answer.image %}
                        {{answer.label}}
                        <img src="{{answer.image.url}}" class="mcq-image-answer image-in-formatted" alt="{{answer.image.label}}"/>
                    {% else %}
                        {{answer.content|safe}}
                    {% endif %}
                {% endif %}
            </div>
            {% if answer.is_answer%}
                <button type="button" class="btn btn-info exempt">True</button>
            {% else %}
                <button type="button" class="btn btn-warning exempt">False</button>
            {% endif %}
        {% endfor %}
    {% else %}
        <p class="question-answer">
            {% for answer in answers %}
            <strong>Answer </strong>
                <div class="formatted-answer">
                    {% if not is_fr %}
                        {{answer.content}}  
                    {% else %}
                        *Free reponse question.*
                    {% endif %}
                </div>
            {% endfor %}
        </p>
    {% endif %}

{% endif %}
</div>
{% endblock %}
{% block scripts %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="{% static 'phobos/js/question_view.js' %}"></script>

<script>
    export_question= document.querySelector('.export_question')
    btn_export_question = export_question.querySelector('button')
    export_to_assignment = export_question.querySelector('div')
    export_result= export_question.querySelector('.export_result')


    export_question.querySelector('button').addEventListener('click',()=>{
        console.log('dkfjldkjfkl')
        export_to_assignment.style.display='block';
        export_result.style.display= 'none';
    })

    export_to_assignment.querySelector('input[type=button]').addEventListener('click',()=>{ 
console.log(export_to_assignment.querySelector('select').value);// if 
            fetch(window.location.href+ '/export_question_to/'+ export_to_assignment.querySelector('select').value) 
            .then(response=>response.json())
            .then(result=>{
                console.log(result)
               
                export_result.innerHTML= result;
                export_result.style.display= 'block';
                export_to_assignment.style.display='none';
            })
        
    })

</script>
{% endblock %}